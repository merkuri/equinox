<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- Let your simulation scale gracefully, like the orbits of heavenly bodies -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Equinox 3D Simulation</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    #simulationContainer {
      flex: 1 1 600px;
      text-align: center;
    }
    #simulationCanvasContainer {
      border: 1px solid #ccc;
      background: #fff;
      max-width: 600px;
      width: 100%;
      height: 600px;
      margin: auto;
    }
    .controls {
      margin-top: 10px;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
    }
    #legend {
      flex: 1 1 250px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      margin-left: 20px;
      max-width: 250px;
      height: fit-content;
      font-size: 14px;
    }
    @media (max-width: 700px) {
      #legend {
        margin-left: 0;
        margin-top: 20px;
      }
    }
  </style>
</head>
<body>
  <div id="simulationContainer">
    <h1 id="title">Equinox 3D Simulation</h1>
    <div id="simulationCanvasContainer"></div>
    <div class="controls">
      <button id="togglePlay">Pause</button>
      <button id="stepButton">Step</button>
      <button id="fasterButton">Faster</button>
      <button id="slowerButton">Slower</button>
      <button id="langToggle"><span id="langFlag">ðŸ‡¦ðŸ‡±</span></button>
    </div>
  </div>
  <div id="legend">
    <h3>Legend / Commands</h3>
    <ul>
      <li><strong>Play/Pause:</strong> Toggle simulation (or tap once when running to pause).</li>
      <li><strong>Step:</strong> Advance one step when paused.</li>
      <li><strong>Faster/Slower:</strong> Adjust simulation speed.</li>
      <li><strong>Language:</strong> Switch between English and Albanian.</li>
    </ul>
  </div>

  <!-- Include Three.js (and optionally OrbitControls for free camera movement) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
  <script>
    // Set up the 3D sceneâ€”a cosmic stage for our Earthâ€“Sun dance.
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf0f0f0);

    const camera = new THREE.PerspectiveCamera(45, 600/600, 0.1, 1000);
    camera.position.set(0, 150, 400);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(600, 600);
    document.getElementById("simulationCanvasContainer").appendChild(renderer.domElement);

    // OrbitControls let you wander among the stars (or at least around our scene)
    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    // Create the Sunâ€”a radiant sphere at the center.
    const sunGeometry = new THREE.SphereGeometry(15, 32, 32);
    const sunMaterial = new THREE.MeshBasicMaterial({ color: 0xffa500 });
    const sunMesh = new THREE.Mesh(sunGeometry, sunMaterial);
    scene.add(sunMesh);

    // Add a point light at the Sun's position so our Earth glows with gentle luminescence.
    const sunLight = new THREE.PointLight(0xffffff, 1.5, 0);
    sunLight.position.set(0, 0, 0);
    scene.add(sunLight);

    // Draw Earth's orbital path (a perfect circle in the xzâ€“plane).
    const orbitRadius = 200;
    const orbitCurve = new THREE.EllipseCurve(
      0, 0,                // ax, aY (center of the orbit)
      orbitRadius, orbitRadius,  // xRadius, yRadius
      0, 2 * Math.PI,      // startAngle, endAngle
      false, 0
    );
    const orbitPoints = orbitCurve.getPoints(64);
    const orbitGeometry = new THREE.BufferGeometry().setFromPoints(
      orbitPoints.map(p => new THREE.Vector3(p.x, 0, p.y))
    );
    const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xaaaaaa });
    const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
    scene.add(orbitLine);

    // Build a group to control Earth's orbital motion.
    const earthOrbit = new THREE.Group();
    scene.add(earthOrbit);

    // The earthGroup will handle axial tilt. Position it at (orbitRadius, 0, 0)
    // so that when the earthOrbit rotates, Earth follows its orbit around the Sun.
    const earthGroup = new THREE.Group();
    earthGroup.position.set(orbitRadius, 0, 0);
    earthOrbit.add(earthGroup);

    // Draw the Northâ€“South axis as a red line (its length is exaggerated for clarity).
    const axisLength = 30 * 1.5;  // earthRadius * tiltExaggeration
    const nsAxisGeometry = new THREE.BufferGeometry().setFromPoints([
      new THREE.Vector3(0, axisLength, 0),
      new THREE.Vector3(0, -axisLength, 0)
    ]);
    const nsAxisMaterial = new THREE.LineBasicMaterial({ color: 0xff0000 });
    const nsAxisLine = new THREE.Line(nsAxisGeometry, nsAxisMaterial);
    earthGroup.add(nsAxisLine);

    // Create a pivot for Earth's selfâ€“rotation.
    const earthPivot = new THREE.Group();
    earthGroup.add(earthPivot);

    // Create the Earth as a blue sphere.
    const earthRadius = 30;
    const earthGeometry = new THREE.SphereGeometry(earthRadius, 32, 32);
    const earthMaterial = new THREE.MeshPhongMaterial({ color: 0x0000ff, shininess: 50 });
    const earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
    earthPivot.add(earthMesh);

    // Draw the equator as a white circle.
    // Instead of modifying vertices (which is deprecated), we create the circle from scratch.
    const segments = 64;
    const equatorPoints = [];
    for (let i = 0; i <= segments; i++){
      const theta = (i / segments) * Math.PI * 2;
      equatorPoints.push(new THREE.Vector3(earthRadius * Math.cos(theta), 0, earthRadius * Math.sin(theta)));
    }
    const equatorGeometry = new THREE.BufferGeometry().setFromPoints(equatorPoints);
    const equatorMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
    const equatorLine = new THREE.LineLoop(equatorGeometry, equatorMaterial);
    earthPivot.add(equatorLine);

    // A small black marker on the equator shows Earth's selfâ€“rotation.
    const markerGeometry = new THREE.SphereGeometry(2, 16, 16);
    const markerMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
    const markerMesh = new THREE.Mesh(markerGeometry, markerMaterial);
    markerMesh.position.set(earthRadius, 0, 0);
    earthPivot.add(markerMesh);

    // Simulation state variables: a day counter, speed, and the spin of our blue orb.
    let day = 80;  // Start near the spring equinox
    let speed = 0.5;  // Days per frame
    let isPaused = false;
    let earthSpin = 0;  // Earth's self rotation (in radians)
    const maxTilt = 23.5 * Math.PI / 180;  // Earth's tilt in radians

    // For the bilingual soul
    let language = "en";

    // The animation loopâ€”a cosmic waltz updating orbital and axial rotations.
    function animate() {
      requestAnimationFrame(animate);

      if (!isPaused) {
        day += speed;
        if (day >= 365) day -= 365;
        earthSpin += 0.1;
      }

      // Earth's orbital position (rotation around the Sun)
      const orbitalAngle = 2 * Math.PI * (day / 365);
      earthOrbit.rotation.y = orbitalAngle;

      // Compute effective tilt (mimicking seasonal variation)
      const effectiveTilt = maxTilt * Math.sin(2 * Math.PI * ((day - 80) / 365));
      // Rotate the earthGroup about its local Zâ€“axis so that the Nâ€“S axis tilts only within
      // the plane formed by the Nâ€“S axis and the Sunâ€“Earth line (here, always perpendicular to the orbital plane)
      earthGroup.rotation.z = effectiveTilt;

      // Selfâ€“rotation: spin the Earth about its own (tilted) axis.
      earthPivot.rotation.y = earthSpin;

      renderer.render(scene, camera);
    }
    animate();

    // Handle window resizes (the heavens adapt as we do).
    window.addEventListener('resize', function(){
      const width = 600;
      const height = 600;
      renderer.setSize(width, height);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    });

    // Button controlsâ€”because even cosmic simulations appreciate a little user guidance.
    document.getElementById("togglePlay").addEventListener("click", function () {
      isPaused = !isPaused;
      this.textContent = isPaused 
        ? (language === "en" ? "Resume" : "Vazhdo")
        : (language === "en" ? "Pause" : "Ndalo");
    });
    document.getElementById("stepButton").addEventListener("click", function () {
      if (isPaused) {
        day += speed;
        if (day >= 365) day -= 365;
      }
    });
    document.getElementById("fasterButton").addEventListener("click", function () {
      speed *= 2;
    });
    document.getElementById("slowerButton").addEventListener("click", function () {
      speed /= 2;
    });
    document.getElementById("langToggle").addEventListener("click", function () {
      language = (language === "en") ? "al" : "en";
      document.getElementById("togglePlay").textContent = isPaused 
        ? (language === "en" ? "Resume" : "Vazhdo")
        : (language === "en" ? "Pause" : "Ndalo");
      document.getElementById("stepButton").textContent = (language === "en") ? "Step" : "Hapi";
      document.getElementById("fasterButton").textContent = (language === "en") ? "Faster" : "MÃ« shpejt";
      document.getElementById("slowerButton").textContent = (language === "en") ? "Slower" : "MÃ« ngadalÃ«";
      document.getElementById("title").textContent = (language === "en")
        ? "Equinox 3D Simulation"
        : "Simulimi 3D i Ekuinoksit";
      document.getElementById("langFlag").textContent = (language === "en") ? "ðŸ‡¦ðŸ‡±" : "ðŸ‡¬ðŸ‡§";
    });
  </script>
</body>
</html>
